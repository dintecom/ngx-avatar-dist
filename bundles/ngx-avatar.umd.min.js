!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common"),require("is-retina"),require("ts-md5/dist/md5"),require("@angular/common/http"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("ngx-avatar",["exports","@angular/core","@angular/common","is-retina","ts-md5/dist/md5","@angular/common/http","rxjs","rxjs/operators"],e):e((t=t||self)["ngx-avatar"]={},t.ng.core,t.ng.common,t.isRetina,t.md5,t.ng.common.http,t.rxjs,t.rxjs.operators)}(this,function(t,e,r,o,i,n,s,a){"use strict";o=o&&o.hasOwnProperty("default")?o["default"]:o;var c=function(t,e){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function u(t,e){function r(){this.constructor=t}c(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var h=function(){return(h=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function p(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var o,i,n=r.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(o=n.next()).done;)s.push(o.value)}catch(a){i={error:a}}finally{try{o&&!o.done&&(r=n["return"])&&r.call(n)}finally{if(i)throw i.error}}return s}function f(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(p(arguments[e]));return t}var l=function(){return function(t){this.sourceId=t}}(),v={FACEBOOK:"facebook",GOOGLE:"google",TWITTER:"twitter",VKONTAKTE:"vkontakte",SKYPE:"skype",GRAVATAR:"gravatar",GITHUB:"github",CUSTOM:"custom",INITIALS:"initials",VALUE:"value"},d=function(){function t(t){this.sourceId=t,this.sourceType=v.FACEBOOK}return t.prototype.getAvatar=function(t){return"https://graph.facebook.com/"+this.sourceId+"/picture?width="+t+"&height="+t},t}(),y=function(){function t(t){this.sourceId=t,this.sourceType=v.TWITTER}return t.prototype.getAvatar=function(t){var e=this.getImageSize(t);return"https://twitter.com/"+this.sourceId+"/profile_image?size="+e},t.prototype.getImageSize=function(t){return t<=24?"mini":t<=48?"normal":t<=73?"bigger":"original"},t}(),g=function(t){function e(e){var r=t.call(this,e)||this;return r.sourceType=v.GOOGLE,r}return u(e,t),e.prototype.getAvatar=function(){return"https://picasaweb.google.com/data/entry/api/user/"+this.sourceId+"?alt=json"},e.prototype.processResponse=function(t,e){var r=t.entry.gphoto$thumbnail.$t;if(r)return r.replace("s64","s"+e)},e}(l),S=function(){function t(t){this.sourceId=t,this.sourceType=v.CUSTOM}return t.prototype.getAvatar=function(){return this.sourceId},t}(),I=function(){function t(t){this.sourceId=t,this.sourceType=v.INITIALS}return t.prototype.getAvatar=function(t){return this.getInitials(this.sourceId,t)},t.prototype.getInitials=function(t,e){if(!(t=t?t.trim():null))return"";var r=t.split(" ");return e&&e<r.length?this.constructInitials(r.slice(0,e)):this.constructInitials(r)},t.prototype.constructInitials=function(t){return t&&t.length?t.filter(function(t){return t&&t.length>0}).map(function(t){return t[0].toUpperCase()}).join(""):""},t}(),A=function(){function t(t){this.value=t,this.sourceType=v.GRAVATAR,this.sourceId=t.match("^[a-f0-9]{32}$")?t:i.Md5.hashStr(t).toString()}return t.prototype.getAvatar=function(t){var e=o()?2*t:t;return"https://secure.gravatar.com/avatar/"+this.sourceId+"?s="+e+"&d=404"},t}(),m=function(){function t(t){this.sourceId=t,this.sourceType=v.SKYPE}return t.prototype.getAvatar=function(){return"https://api.skype.com/users/"+this.sourceId+"/profile/avatar"},t}(),C=function(){function t(t){this.sourceId=t,this.sourceType=v.VALUE}return t.prototype.getAvatar=function(){return this.sourceId},t}(),T=function(t){function e(e){var r=t.call(this,e)||this;return r.sourceType=v.VKONTAKTE,r}return u(e,t),e.prototype.getAvatar=function(t){var e=this.getImageSize(t);return"https://api.vk.com/method/users.get?user_id="+this.sourceId+"&v=5.8&fields="+e},e.prototype.processResponse=function(t){var e=Object.keys(t.response[0]).pop();return t.response[0][e]},e.prototype.getImageSize=function(t){return t<=50?"photo_50":t<=100?"photo_100":t<=200?"photo_200":"photo_max"},e}(l),b=function(t){function e(e){var r=t.call(this,e)||this;return r.sourceType=v.GITHUB,r}return u(e,t),e.prototype.getAvatar=function(){return"https://api.github.com/users/"+this.sourceId},e.prototype.processResponse=function(t,e){return e?t.avatar_url+"&s="+e:t.avatar_url},e}(l),O=function(){function t(){this.sources={},this.sources[v.FACEBOOK]=d,this.sources[v.TWITTER]=y,this.sources[v.GOOGLE]=g,this.sources[v.SKYPE]=m,this.sources[v.GRAVATAR]=A,this.sources[v.CUSTOM]=S,this.sources[v.INITIALS]=I,this.sources[v.VALUE]=C,this.sources[v.VKONTAKTE]=T,this.sources[v.GITHUB]=b}return t.prototype.newInstance=function(t,e){return new this.sources[t](e)},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[]},t}(),x=new e.InjectionToken("avatar.config"),E=function(){function t(t){this.userConfig=t}return t.prototype.getAvatarSources=function(t){if(this.userConfig&&this.userConfig.sourcePriorityOrder&&this.userConfig.sourcePriorityOrder.length){var e=f(new Set(this.userConfig.sourcePriorityOrder)).filter(function(e){return t.includes(e)});return f(e,t.filter(function(t){return!e.includes(t)}))}return t},t.prototype.getAvatarColors=function(t){return this.userConfig&&this.userConfig.colors&&this.userConfig.colors.length&&this.userConfig.colors||t},t.prototype.getCacheLifetime=function(t){return this.userConfig&&isFinite(this.userConfig.cacheLifetimeSecond)&&this.userConfig.cacheLifetimeSecond||t},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:undefined,decorators:[{type:e.Optional},{type:e.Inject,args:[x]}]}]},t}(),R=[v.FACEBOOK,v.GOOGLE,v.TWITTER,v.VKONTAKTE,v.SKYPE,v.GRAVATAR,v.GITHUB,v.CUSTOM,v.INITIALS,v.VALUE],z=["#1abc9c","#3498db","#f1c40f","#8e44ad","#e74c3c","#d35400","#2c3e50","#7f8c8d"],k=1800,L=function(){function t(t,e){this.http=t,this.avatarConfigService=e,this.avatarSources=R,this.avatarColors=z,this.cacheLifetimeSecond=k,this.cache={},this.requestCache={},this.overrideAvatarSources(),this.overrideAvatarColors(),this.overrideCacheLifetime()}return t.prototype.fetchAvatar=function(t){var e=this;return this.cache[t]?this.cache[t].error?s.throwError(this.cache[t].error):s.of(this.cache[t].avatar):this.requestCache[t]?this.requestCache[t]:(this.requestCache[t]=this.http.get(t).pipe(a.tap(function(r){delete e.requestCache[t],e.cache[t]={avatar:r}}),a.catchError(function(r){return delete e.requestCache[t],e.cache[t]={error:r},s.throwError(r)}),a.finalize(function(){setTimeout(function(){return delete e.cache[t]},1e3*e.cacheLifetimeSecond)}),a.share()),this.requestCache[t])},t.prototype.getRandomColor=function(t){if(!t)return"transparent";var e=this.calculateAsciiCode(t);return this.avatarColors[e%this.avatarColors.length]},t.prototype.copmareSources=function(t,e){return this.getSourcePriority(t)-this.getSourcePriority(e)},t.prototype.isSource=function(t){return this.avatarSources.includes(t)},t.prototype.isTextAvatar=function(t){return[v.INITIALS,v.VALUE].includes(t)},t.prototype.overrideAvatarSources=function(){this.avatarSources=this.avatarConfigService.getAvatarSources(R)},t.prototype.overrideAvatarColors=function(){this.avatarColors=this.avatarConfigService.getAvatarColors(z)},t.prototype.overrideCacheLifetime=function(){this.cacheLifetimeSecond=this.avatarConfigService.getCacheLifetime(k)},t.prototype.calculateAsciiCode=function(t){return t.split("").map(function(t){return t.charCodeAt(0)}).reduce(function(t,e){return t+e})},t.prototype.getSourcePriority=function(t){return this.avatarSources.indexOf(t)},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:n.HttpClient},{type:E}]},t}(),w=function(){function t(t,r,o){this.elementRef=t,this.sourceFactory=r,this.avatarService=o,this.round=!0,this.size=50,this.textSizeRatio=3,this.fgColor="#FFF",this.style={},this.cornerRadius=0,this.clickOnAvatar=new e.EventEmitter,this.isAlive=!0,this.avatarStyle={},this.hostStyle={},this.currentSource=0,this.sources=Array()}return t.prototype.onAvatarClicked=function(){this.clickOnAvatar.emit(this.sources[this.currentSource-1])},t.prototype.ngOnChanges=function(t){for(var e in t)if(this.avatarService.isSource(e)){var r=v[e.toUpperCase()];if(t[e].currentValue){var o=t[e].currentValue;this.addSource(r,o)}else this.removeSource(r)}this.initializeAvatar()},t.prototype.fetchAvatarSource=function(t){var e=this.sources[this.currentSource];e&&(this.avatarService.isTextAvatar(e.sourceType)?(this.buildTextAvatar(e),this.avatarSrc=undefined):this.buildImageAvatar(e),this.currentSource++)},t.prototype.ngOnDestroy=function(){this.isAlive=!1},t.prototype.initializeAvatar=function(){this.currentSource=0,this.sources.length>0&&this.sources[this.currentSource]&&(this.sortAvatarSources(),this.fetchAvatarSource(),this.hostStyle={width:this.size+"px",height:this.size+"px"})},t.prototype.sortAvatarSources=function(){var t=this;this.sources.sort(function(e,r){return t.avatarService.copmareSources(e.sourceType,r.sourceType)})},t.prototype.buildTextAvatar=function(t){this.avatarText=t.getAvatar(this.initialsSize),this.avatarStyle=this.getInitialsStyle(t.sourceId)},t.prototype.buildImageAvatar=function(t){this.avatarStyle=this.getImageStyle(),t instanceof l?this.fetchAndProcessAsyncAvatar(t):this.avatarSrc=t.getAvatar(this.size)},t.prototype.getInitialsStyle=function(t){return h({textAlign:"center",borderRadius:this.round?"100%":this.cornerRadius+"px",border:this.borderColor?"1px solid "+this.borderColor:"",textTransform:"uppercase",color:this.fgColor,backgroundColor:this.bgColor?this.bgColor:this.avatarService.getRandomColor(t),font:Math.floor(this.size/this.textSizeRatio)+"px Helvetica, Arial, sans-serif",lineHeight:this.size+"px"},this.style)},t.prototype.getImageStyle=function(){return h({maxWidth:"100%",borderRadius:this.round?"50%":this.cornerRadius+"px",border:this.borderColor?"1px solid "+this.borderColor:"",width:this.size,height:this.size},this.style)},t.prototype.fetchAndProcessAsyncAvatar=function(t){var e=this;this.avatarService.fetchAvatar(t.getAvatar()).pipe(a.takeWhile(function(){return e.isAlive}),a.map(function(r){return t.processResponse(r,e.size)})).subscribe(function(t){return e.avatarSrc=t})},t.prototype.addSource=function(t,e){if(this.isSourceExist(t)){var r=this.sources.findIndex(function(e){return e.sourceType===t});this.sources[r].sourceId=e}else this.sources.push(this.sourceFactory.newInstance(t,e))},t.prototype.removeSource=function(t){if(this.isSourceExist(t)){var e=this.sources.findIndex(function(e){return e.sourceType===t});this.sources.splice(e,1)}},t.prototype.isSourceExist=function(t){return this.sources.map(function(t){return t.sourceType}).includes(t)},t.decorators=[{type:e.Component,args:[{selector:"ngx-avatar",template:'\n    <div\n      (click)="onAvatarClicked()"\n      class="avatar-container"\n      [ngStyle]="hostStyle"\n    >\n      <img\n        *ngIf="avatarSrc; else textAvatar"\n        [src]="avatarSrc"\n        [width]="size"\n        [height]="size"\n        [ngStyle]="avatarStyle"\n        (error)="fetchAvatarSource($event)"\n        class="avatar-content"\n      />\n      <ng-template #textAvatar>\n        <div *ngIf="avatarText" class="avatar-content" [ngStyle]="avatarStyle">\n          {{ avatarText }}\n        </div>\n      </ng-template>\n    </div>\n  ',styles:["\n      :host {\n        border-radius: '50%';\n      }\n    "]}]}],t.ctorParameters=function(){return[{type:e.ElementRef},{type:O},{type:L}]},t.propDecorators={round:[{type:e.Input}],size:[{type:e.Input}],textSizeRatio:[{type:e.Input}],bgColor:[{type:e.Input}],fgColor:[{type:e.Input}],borderColor:[{type:e.Input}],style:[{type:e.Input}],cornerRadius:[{type:e.Input}],facebook:[{type:e.Input,args:["facebookId"]}],twitter:[{type:e.Input,args:["twitterId"]}],google:[{type:e.Input,args:["googleId"]}],vkontakte:[{type:e.Input,args:["vkontakteId"]}],skype:[{type:e.Input,args:["skypeId"]}],gravatar:[{type:e.Input,args:["gravatarId"]}],github:[{type:e.Input,args:["githubId"]}],custom:[{type:e.Input,args:["src"]}],initials:[{type:e.Input,args:["name"]}],value:[{type:e.Input,args:["value"]}],placeholder:[{type:e.Input,args:["placeholder"]}],initialsSize:[{type:e.Input,args:["initialsSize"]}],clickOnAvatar:[{type:e.Output}]},t}(),P=function(){function t(){}return t.forRoot=function(e){return{ngModule:t,providers:[{provide:x,useValue:e||{}}]}},t.decorators=[{type:e.NgModule,args:[{imports:[r.CommonModule],declarations:[w],providers:[O,L,E],exports:[w]}]}],t}();t.AvatarComponent=w,t.AvatarModule=P,t.AvatarService=L,t.AvatarSource=v,t.defaultCacheLifetimeSecond=k,t.defaultColors=z,t.defaultSources=R,t.ɵa=O,t.ɵb=E,t.ɵc=x,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-avatar.umd.min.js.map